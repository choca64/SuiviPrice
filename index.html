<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Tracking System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable" defer></script>
    <script src="script.js" defer></script>
   
</head>
<body>
    <div class="app" id="app">
        <div class="container">
            <h1>Price Tracking System</h1>
        </div>
        <main>
            <section class="form-section" id="form-section">
                <h2>Suivi Modification Prix</h2>
                <form @submit.prevent="updatePrice" class="formulaire">
                    <div class="inputtext">
                        <label for="product-id">ID Produit :</label>
                        <input type="text" id="product-id" v-model="newEntry.id" readonly placeholder="Sélectionné automatiquement">
                    </div>
                    <div class="input-wrapper">
                        <label for="product-name">Nom Produit :</label>
                        <input type="text" id="product-name" v-model="newEntry.product" @input="filterProducts" required>
                        <ul v-if="filteredSuggestions.length > 0" id="suggestions-list">
                            <li 
                                v-for="(product, index) in filteredSuggestions" 
                                :key="product.id" 
                                @click="selectProduct(product)">
                                {{ product.product }} (ID: {{ product.id }})
                            </li>
                        </ul>
                    </div>
                    <div class="inputtext">
                        <label for="new-price">Nouveau prix :</label>
                        <input type="number" id="new-price" v-model="newEntry.newPrice" step="0.01" required>
                    </div>
                    <div class="inputtext">
                        <label for="rayon">Rayon :</label>
                        <input type="text" id="rayon" v-model="newEntry.rayon" required>
                    </div>
                    <button type="submit">Update Price</button>
                </form>
            </section>
            <button @click="openModal" class="add-product-button">Ajouter un Produit</button>
            
            <!-- Modal pour ajout de produit -->
            <div v-if="showModal" class="modal-overlay">
                <div class="modal">
                    <h2>Ajouter un Produit</h2>
                    <form @submit.prevent="addProduct" class="modal-form">
                        <div class="inputtext">
                            <label for="modal-product-id">ID Produit :</label>
                            <input type="text" id="modal-product-id" v-model="modalEntry.id" placeholder="Généré automatiquement si vide">
                        </div>
                        <div class="inputtext">
                            <label for="modal-product-name">Nom Produit :</label>
                            <input type="text" id="modal-product-name" v-model="modalEntry.product" required>
                        </div>
                        <div class="inputtext">
                            <label for="modal-new-price">Prix :</label>
                            <input type="number" id="modal-new-price" v-model="modalEntry.newPrice" step="0.01" required>
                        </div>
                        <div class="inputtext">
                            <label for="modal-rayon">Rayon :</label>
                            <input type="text" id="modal-rayon" v-model="modalEntry.rayon" required>
                        </div>
                        <button type="submit">Ajouter Produit</button>
                        <button type="button" @click="closeModal">Annuler</button>
                    </form>
                </div>
            </div>

            <div class="returnprod">
                <section id="filters">
                    <div class="rayon">
                        <h2>Filtre par Rayon</h2>
                        <div class="selectrayon">
                            <label for="rayon-filter">Sélectionner un Rayon :</label>
                            <select id="rayon-filter" v-model="selectedRayon">
                                <option value="">All</option>
                                <option v-for="rayon in uniqueRayons" :key="rayon" :value="rayon">{{ rayon }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="date">
                        <h2>Filtre par Date</h2>
                        <div class="selectdate">
                            <label for="date-filter">Sélectionner une Date :</label>
                            <input type="date" id="date-filter" v-model="selectedDate" />
                        </div>
                    </div>    
                    <div class="id-search">
                        <h2>Recherche par ID</h2>
                        <div class="inputtext">
                            <label for="id-filter">Rechercher ID :</label>
                            <input type="text" id="id-filter" v-model="searchID" placeholder="Entrez un ID">
                        </div>
                    </div>
                </section>
                <section id="price-table">
                    <h2>Price History</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Product</th>
                                <th>Rayon</th>
                                <th>Old Price</th>
                                <th>New Price</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(entry, index) in filteredHistory" :key="entry.id">
                                <td>{{ entry.id }}</td>
                                <td>
                                    <input v-if="entry.isEditing" type="text" v-model="entry.product">
                                    <span v-else>{{ entry.product }}</span>
                                </td>
                                <td>
                                    <input v-if="entry.isEditing" type="text" v-model="entry.rayon">
                                    <span v-else>{{ entry.rayon }}</span>
                                </td>
                                <td>{{ entry.oldPrice }}</td>
                                <td>{{ entry.newPrice }}</td>
                                <td>{{ formatDate(entry.date) }}</td>
                                <td class="actions">
                                    <button v-if="!entry.isEditing" @click="editEntry(index)">Edit</button>
                                    <button v-if="entry.isEditing" @click="saveEdit(index)">Save</button>
                                    <button v-if="entry.isEditing" @click="cancelEdit(index)">Cancel</button>
                                    <button @click="confirmDelete(index)">Delete</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="generatepdf">
                    <button @click="generatePDF" class="generate-pdf">Télécharger le PDF</button>
                    </div>
                </section>
            </div>
        </main>
    </div>
</body>
</html>